# 11 성능, 확장성
- 스레드를 사용하는 가장 큰 목적 = 성능을 높임
- 스레드를 사용하면 시스템의 자원을 훨씬 효율적으로 활용할 수 있고, 애플리케이션으로 하여금 시스템이 갖고 있는 능력을 최대한 사용하게 할 수 있고 응답속도도 향상시킬 수 있다.
- 11장에서는 병렬프로그램의 성능을 분석하고, 모니터링하고, 그 결과로 성능을 향상시킬 수 있는 방법에 대해 알아본다.
- 대부분 애플리케이션의 내부 구조를 복잡하게 만들어야 하는 경우가 많고, 안전성과 활동성에 문제가 생길 가능성도 많다.
    - 성능을 높이기 위해 적용한 프로그래밍 기법이 역효과를 가져올 수도 있다.
    - 성능때문에 안전성을 해칠 수는 없다.
- 일단 프로그램이 정상적으로 동작하도록 만들고 난 다음 프로그램이 빠르게 동작하는 편이 낫다.

## 11.1 성능에 대해
- 성능을 높이는 것 = 더 적은 자원을 사용하면서 더 많은 일을 하도록 한다
    - 자원 -> 처리해야 할 작업이 있을 때 CPU, 메모리, 네트워크 속도, 디스크 속도, 데이터베이스 처리 속도, 디스크 용량 가운데 하나
- 자원중에 항상 모자라는 부분이 발생할 것이다.
- 작업을 실행할 때 충분하지 못한 특정 자원 때문ㅇ ㅔ성능이 떨어지는 현상이 나타난다면, 작업의 성능이 해당 자원에 좌우된다고 한다.
- 적절한 작업 비용을 스레드에 효율적으로 적용한다면 성능이나 응답성이 높아지고 처리 용량도 커지는 장점이 있다.
- 그러나 잘못 설계된 병렬 애플리케이션은 순차적으로 작업을 처리하는 프로그램보다 느리게 동작하는 경우도 간혹 생긴다.
- 더 나은 성능을 목표로 프로그램이 병렬로 동작하게 할 경우 생각해야할 2가지
    - 1. 프로그램이 확보할 수 있는 모든 자원을 최대한 활용
    - 2. 남는 자원이 생길 때마다 그 자원 역시 최대한 활용
### 11.1.1 성능 대 확장성
- 애플리케이션의 성능은 여러가지 측변에서 자료를 수집해 측정 가능
    - 서비스 시간, 대기 시간(얼마나 빠르냐), 처리량, 용량(얼마나 많은 양을 하냐), 효율성, 확장성(CPU, 메모리, 디스크, I/O 장치 등의 추가적인 정비를 사용해 처리량이나 용량을 얼마나 쉽게 키울 수 있냐) 등
- 병렬 프로그램 환경에서 확장성을 충분히 가질 수 있도록 애플리케이션을 설계하고 튜닝하는 방법은 기존에 해오던 일반적인 성능 최적화 방법과 다른 부분이 많다.
- 성능을 높이기 위해서 튜닝 작업을 하는 경우에 그 목적은 동일한 일을 더 적은 노력으로 하고자 하는것 (O(n^2) -> O(n log n)) 
- 성능에서 얼마나 빠르게와 얼마나 많이는 완전히 다른 뜻을 가지며, 심지어 서로 화합할 수 없는 상황도 생긴다. 
- 더 높은 확장성을 확보하거나 하드웨어의 자원을 더 많이 활용하도록 하다 보면, 앞서 큰 작업 하나를 작은 여러 개의 작업으로 분할해 처리하는 것처럼 개별 작업을 처리할 때 필요한 작업의 양을 늘리는 결과를 얻을 때가 많다.
- 단일 스레드 애플리케이션에서 사용하던 성능 개선 방안은 대부분 확장성의 측면에서 효과적이지 않다.
- 3-티어 모델을 보면 시스템의 확장성을 높이도록 변경하려 할 때 성능의 측면에서 얼마나 많은 소해를 보는 경우가 많은지 쉽게 알 수 있다.
- 프리젠테이션, 비지니스 로직, 스로티지의 세 가지 부분이 하나로 통합돼 있는 단일 애플리케이션을 다중 티어 애플리케이션과 비교해 보면, 다중 티어 애플리케이션이 웬만큼 잘 만들어져있다 하더라도 별다른 튜닝을 하지 않은 단일 애플리케이션의 성능이 훨씬 나을 가능성이 ㅁ낳다.
    - 단일 구조 애플리케이션은 서로 다른 티어 간에 주고받는 도중에 발생하는 네트워크 시간 지연 현상도 없을 것이고, 연산 작업을 서로 다른 추상적인 계층을 통과시켜가며 처리하는데 드는 부하가 적기 때문
- 하지만 단일 구조의 애플리케이션이 처리할 수 있었던 최대 부하를 넘어서는 작업량을 감당해야 하는 순간이 오면 문제는 심각.
- 서버 애플리케이션을 만들 때는 얼마나 빠르게라는 측면보다 얼마나 많이 라는 측면, 즉 확장성과 처리량과 용량이 훨씬 중요하다. 
- 11장에서는 단일 스레드 상황에서의 성능보다는 확장성을 중점적으로 다룬다.

### 11.1.2 성능 트레이드 오프 측정
- 공학적인 모든 선택의 순간에는 항상 트레이드 오프가 존재하기 마련.
- 강 위에 다리를 건설할 때 돔더 두꺼운 강판을 사용하면 다리를 수용할 수 있는 용량이 늘어나고 아전성도 높아지겠지만 건설 비용 역시 크게 증가.
- 소프트웨어 공학에서는 트레이트 오프에서 어떤 부분을 선택해야 할지를 결정하는데 필요한 정보가 그다지 충분하지 않다.
    - ex: 퀵소트 알고리즘은 대량의 자료를 정렬할 때 효율이 높지만, 자료의 양이 많지 않을 경우 버블 정렬 알고리즘이 훨씬 효율적이다.
- 프로그램을 작성하는 도중에 효율적인 정렬 기능을 구현해야 할 필요가 있따면, 먼저 정렬할 대상 데이터의 규모가 어느 정도인지 먼저 알아낼 필요가 있고, 평균적인 처리 시간을 중점적으로 최적화할지, 최악의 경우에 중점을 둬야 할지, 아니면 예측성에 중점을 둬야 하는지에 대한 결정을 내릴 수 있도록 추가적인 자료를 뽑아내는 것도 좋다.
- 하지만 일반적으로 정렬 기능을 라이브러리로 구현하는 입장에서 알 수 있는 정보는 굉장히 제한적이다.
- 그러므로 최적화 기법을 너무 이른 시점에 적용하지 말아야 한다. 일단 제대로 동작하게 만들고 난 다음에 빠르게 동작하도록 최적화해야 하며, 예상한 것보다 심각하게 성능이 떨어지는 경우에만 최적화 기법을 적용하는 것으로도 충분하다.
- 공학적인 결정을 내려야 하는 시저에는 어떤 효과를 얻고자 할 때 다른 비용을 지출해야만 할 수 있고, 또 어떤 경우에는 안전성을 확보하기 위해 비용을 지불해야 할 수도 있다.
- 성능을 높이기 위한 대부분의 결정 사항에는 다양한 변수가 관여하곤 하고 처한 상황에 따라 결정 사항이 크게 달라진다. 특정 방법이 다른 방법보다 빠르다 라고 말하기 전에 고려해야 할 사항
    - 1. 빠르다란 단어가 무엇을 의마하는가?
    - 2. 어떤 조건을 갖춰야 할 때 이 방법이 실제로 빠르게 동작할 것인가? 부하가 적을 때? 부하가 걸릴 대? 데이터가 많을 때? 데이터가 적을 때? 이런 질문에 대한 대답에 명확한 수치를 보여줄 수 있는가?
    - 3. 위의 조건에 해당하는 경우가 얼마나 많이 발생하는가? 이런 질문에 대한 대답에 명확한 수치를 보여줄 수 있는가?
    - 4. 조건이 달라지는 다른 상황에서도 같은 코드를 사용할 수 있는가?
    - 5. 이 방법으로 성능을 개선하고자 할 때, 숨겨진 비용, 즉 개발 비용이나 유지 보수 비용이 증가하는 부분이 어느 정도인지? 그런 부분을 감수하면서까지 성능 개선 작업을 해야 하는가?
- 이와 같은 판단 기준은 성능과 관련된 설계와 개발에 대한 결정사항이라면 어디든 적용해 볼 수 있지다.
- 병렬 프로그램에서 발생하는 오류의 가장 큰 원인 = 성능을 높이려는 여러 가지 기법
    - 단순한 동기화 방법이 너무 느리다고 전제하고, 직접적인 동기화 구문을 덜 사용할 수 있게 해주고 아주 훌륭한 모습을 갖추긴 했지만 위험성을 많이 내포하고 있는 여러가지 방법이 공개되어 있으며 이런 방법이 동기화 구문과 관련된 여러가지 규칙을 사용하지 않아도 된다는 핑곗거리로 자주 소개되곤 한다.
- 버그의 원인이 될 가능성이 조금이라도 있는 위험도 높은 코드는 매우 주의 깊게 살펴봐야 한다.
- 성능을 높이기 위해 안전성을 떨어뜨리는 것은 최악의 상황, 결국 안전성과 성능 둘 다 놓치게 된다.
- 성능을 튜닝하는 모든 과정에서 항상 성능 목표에 대한 명확한 요구사항이 있어야 하며 그래야 어느 부분을 튜닝하고 어느 시점에서 튜닝을 그만둬야 하는지 판단할 수 있다.
- 성능 튜닝 작업을 한 다음에는 반드시 원하는 목표치를 달성했는지 다시 측정 값을 뽑아내야 한다.
   - 추측하지 말고 실제로 측정해보라.
- 시장에 나온 성능 측정용 제품을 보면 소프트웨어의 성능을 세밀하게 측정해주고, 병목이 어디에 있는지 눈으로 직접 볼 수 있다.

## 11.2 암달의 법칙
